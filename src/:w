#include "simulation_core.h"
#include "simulation_interface.h"
#include "simulation_renderer.h"
#include <raylib.h>

void init_sim(const SimulationCore *core) {
  sim_init_galaxy(core->bodies, core->params, 0, core->bodies->count, 6e3, 0.3,
                  50, 200, 200, 0, 0);

  // sim_init_uniform(core->bodies, 0, 200, 0, 200, 2);
  sim_core_init_leapfrog((SimulationCore *)core);
}

int main(void) {
  SimulationParams params = {.body_count = 10000,
                             .thread_count = 20,
                             .G = 0.1,
                             .eps = 0.1,
                             .dt = 0.001,
                             .theta = 0.5};

  SimulationCore *core = sim_core_create(params);
  init_sim(core);

  InitWindow(800, 800, "N-Body Sim");
  SetTargetFPS(600);

  Camera2D cam = {0};
  cam.zoom = 0.4f;

  while (!WindowShouldClose()) {
    sim_core_step(core);
    sim_render_frame(core, &cam, init_sim);
  }

  sim_core_destroy(core);
  CloseWindow();
}
